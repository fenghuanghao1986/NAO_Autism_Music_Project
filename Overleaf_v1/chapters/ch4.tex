\chapter{Xylo-Bot: An Interactive Music Teaching System} 
As mentioned in Chapter 3, music can be considered as an effective method
for emotion and non-verbal communication. Individuals with ASD are interested in 
interacting with a social robot. Therefore, implement music-based intervention
sessions using humanoid social robot becoming possible. A novel interactive human-robot 
music teaching system design is presented in this chapter. Hardware and software
design will be discussed in the following sections including experiment room setup, platform design, robot selection, and instrument accessories.\\

In order to make the robot play the xylophone properly and be able to conduct a
music-based social interaction scenario, several things needed to be done. 
First, we need to find a proper xylophone with perfect timber; second, we 
have to arrange the xylophone in a proper position in front of the robot 
to make it be visible and be reachable to play; after that, a set of challenge-based 
experimental sessions need to be constructed including: baseline session, intervention
sessions and an exit session with various levels of activities; finally, the
module-based interactive music teaching system is designed and programmed 
which can be implemented into the experimental sessions.\\

\section{Hardware Selection and Design}

\subsection{NAO: A Humanoid Robot}
NAO, the well-known humanoid robot, was selected in the current research which sold by SoftBank company. 
NAO is 58 cm (23 inches) tall, who has 25 degrees of freedom. Most of the human body
movement can be performed by this robot. It also features an onboard multimedia 
system including four microphones for voice recognition and sound localization, 
two speakers for text-to-speech synthesis, and two HD cameras with maximum image 
resolution 1280 * 960 for online observation. As shown in Figure \ref{nao_body}, these 
utilities are located in the middle of the forehead and mouth area. NAOâ€™s 
computer vision module includes facial and shapes recognition units. By using the 
vision feature of the robot, it can see the instrument from its lower camera 
and be able to implement an eye-hand self-calibration system which allows the 
robot to have real-time micro-adjustment of its arms' joints in case of off 
positioning before music play.\\

\begin{figure}[tbp]
	\begin{center}
		\begin{tabular}{c}
			\epsfig{figure=./chapters/fig/naobody.eps, scale = .8}\label{nao_body} \\
		\end{tabular}
		\caption{A Humanoid Robot NAO: 25 Degrees of Freedom, 2 HD Cameras and 4 Microphones} \label{nao_body}
	\end{center}
\end{figure}

The robot arms have a length of approximately 31 cm. The Position feedback sensors
are equipped in each joint of the robot to have real-time localization
information from them, which could provide well protection for robot safety. Each arm
has five degrees of freedom and is equipped with those sensors to measure the position  
of joint movement. To determine the pose of the instrument and the mallets' heads, the robot 
analyzes images from the lower monocular camera located in its head, which has a 
diagonal field of view of 73 degrees. By using these dimensions, proper size instrument
can be selected, and more accessories can be built which will be presented in the following
sections.\\

Four microphone embedded on the toy or NAO's head can be seen in Figure \ref{mic_loc}. 
According to the official Aldebaran documentation, these microphones have sensitivity 
of 20mV/Pa +/-3dB at 1kHz, and an input frequency range of 150Hz - 12kHz. Data 
is recorded as a 16 bit, 48000Hz, 4 channels wave file which meets the 
requirements for designing the online feedback audio score system will be described
in the later section.\\

\begin{figure}[tbp]
	\begin{center}
		\begin{tabular}{c}
			\epsfig{figure=./chapters/fig/mic.eps, scale = 1.2}\label{mic_loc} \\
		\end{tabular}
		\caption{Microphone locations on NAO's head} \label{mic_loc}
	\end{center}
\end{figure}

\subsection{Accessories}
The purpose of this study is to have a toy-size humanoid robot to play with and 
teach music to children with autism. Some necessary accessories 
needed to be purchased and made before the robot able to complete this task. 
All accessories will be discussed in the following paragraphs.\\

\subsubsection{Xylophone: A Toy for Music Beginner}
In this system, due to NAO's open arms' length, a Sonor Toy Sound SM soprano-xylophone 
with 11 sound bars of 2 cm in width was selected and purchased. The instrument has a size of 
31 cm * 9.5 cm * 4 cm, including the resonating body. The smallest sound bar is 
playable in an area of 2.8 cm * 2 cm, the largest in an area of 4.8 cm * 2 cm. The 
instrument is diatonically tuned in C-Major/a-minor. See Figure \ref{xylo640}.
The 11 bars of the xylophone represent 11 different notes (11 frequencies), which covers 
one and a half octave scales starting from C6 to F7. \\ 
In order to provide a music teaching environment system for children with autism, the xylophone
is one of the best choices for such a study. Xylophone, as well known as marimba, has 
categorized as a percussion instrument consisting of a set of metal/wooden bars
struck with mallets to produce delicate musical tones. Other than the keyboard or drum, for playing 
xylophone properly, a unique technique needs to be applied. A proper strike movement is
required to produce a beautiful note coming out of xylophone. This action
is perfect for a practice motor control, and the melody played by the user could also 
support the music emotion learning. \\

\begin{figure}[tbp]
	\begin{center}
		\begin{tabular}{c}
			\epsfig{figure=./chapters/fig/xylo640.eps, scale = .6}\label{xylo640} \\
		\end{tabular}
		\caption{Actual Xylophone and Mallets from NAO's Bottom Camera} \label{xylo640}
	\end{center}
\end{figure}

\subsubsection{Mallet Gripper Design}
For the mallets, we used the pair that came with the xylophone with a modified 
3D printed gripper, which allows the robot hands to hold them properly. The mallets 
are approximately 21 cm in length and include head of a 0.8 cm radius. Comparing 
to other designs, this mallet gripper prides nature holding position for the robot, and
set up a proper modal for participants in holding the mallet stick in a right way. 
See Figure \ref{griper}.\\

\begin{figure}[tbp]
	\begin{center}
		\begin{tabular}{c}
			\epsfig{figure=./chapters/fig/grip.eps, scale = 0.5}\label{griper} \\
		\end{tabular}
		\caption{Mallet Griper} \label{griper}
	\end{center}
\end{figure}

\subsubsection{Instrument Stand Design}
By carefully measured dimensions, a wooden base was designed and laser cut to hold 
the xylophone in a proper height for the robot crouching position. Using this fine adjusted position,
robots can easily be fixed in a location and somehow have the same height level as the 
participants, which makes it more natural in teaching activities for the entire time.
See Figure \ref{stand}.\\
%insert a pic with a session on going

\begin{figure}[tbp]
	\begin{center}
		\begin{tabular}{c}
			\epsfig{figure=./chapters/fig/left_view.eps, scale = 0.3}\label{left} \\
			(a)\\
			\epsfig{figure=./chapters/fig/top_view.eps, scale = 0.3
			} \label{top}\\
			(b)\\
			\epsfig{figure=./chapters/fig/front_view.eps, scale = 0.6} \label{front}\\
			(c)
		\end{tabular}
		\caption{Instrument Stand: (a) Left View (b) Top View (c) Front View.} \label{stand}
	\end{center}
\end{figure}

\section{Experimental Sessions Designs}

\subsection{Experiment Room}
All the sessions were held in an 11ft * 9.5ft * 10ft room located in the Ritchie School of Engineering Room 248, University of Denver.
6 HD surveillance cameras installed at corners, sidewalls, and ceiling of the experimental room see Figure \ref{room}. 
One mini hidden microphone attached at the ceiling camera for sending real-time audio to the observation room in order to let the care
giver listen to. An external hand-held audio recorder was set in front of the participant during
sessions for collecting high-quality audios for the future process.

\begin{figure}[tbp]
	\begin{center}
		\begin{tabular}{c}
			\epsfig{figure=./chapters/fig/room.eps, scale = .6}\label{room} \\
		\end{tabular}
		\caption{Schematic robot-based therapy session and video capturing setting} \label{room}
	\end{center}
\end{figure}

\begin{sidewaysfigure}[tbp]
	\begin{center}
		\begin{tabular}{c}
			\epsfig{figure=./chapters/fig/room_pana.eps, scale = .35}\label{room_pana} \\
		\end{tabular}
		\caption{Experiment Room} \label{room_pana}
	\end{center}
\end{sidewaysfigure}

As shown in Figure \ref{room_pana}, the observation room is located at the back of the one-way
mirror facing at the rear side of participants in order to avoid distraction while sessions ongoing.
Real-time video and audio were broadcast to the observation room during sessions, which
allowed researchers to observe and to record in the meantime. Parents behind the mirror may also 
call off the session in case of an emergency.\\

\subsection{Q-Sensor}
One Q-sensor was used in this study. Participants were required to ware this device while session
in running. It was allowed to take off the sensor during the break upon subjects request. EDA signal
(frequency rate 32Hz) were collected from the Q-sensor attached to the wrists (left or right wrist 
determined by the participants). Taking breaks were frequently required from the participants. 
Due to the fact of this, 2 to 3 pieces of EDA files were recorded after each session. These files 
need to be annotated by comparing the time stamps with the videos. 

\subsection{Participant Selection}
Nine ASD kids (average age: 11.73, std: 3.11) and 7 TD kids (average age: 10.22, std: 2.06) were recruited in this
study. All participants were selected from the potential subject pool with help from the Psychology department. 
For each participant in the ASD group, 6 sessions were delivered, including baseline session,
intervention sessions, and exit session. As for the TD control group, only baseline and exit sessions 
were required for each participant. Every session lasts for 30-60 minutes total depends on the difficulty
of each session and the performance of individuals. Typically, the baseline and exit sessions length 
can be comparable for the same subject. As for the intervention sessions, the duration should gradually increase
one after another due to the challenge level uprising.\\

\subsection{Session Detail}
Baseline and exit sessions contain 2 activities which are 1) music practice and 2) music gameplay.
Participants were asked to complete a challenge like full song play, starting from single note strike
with a color hint. Multiple notes, half song play, and full song play were coming one by one as long as 
participants aced the previous task. After the practice session is done, a freshly designed music game will be 
presented to participants which contain three novel entertaining game modes in it, participants
were allowed to communicate with the robot regarding which mode to play with. Mode 1): the robot will randomly
pick a song from its song bank and play for kids, after each play, a music feeling will be requested from 
participants in order to find out whether music emotion can be recognized from the early age of children; 
Mode 2): a sequence of melody will be randomly generated by a robot with consonance (happy or comfortable feeling) 
or dissonance (sad or uncomfortable feeling) style and oral emotion feeling from participants will be requested 
and physical playback afterward; Mode 3): allows participants to have 5 seconds of free play and challenge the robot to
imitate from the participants what just played by them, after complete robot playing, performance will be rated by
the participants provide teaching experience for all subjects. Note that, there was no limitation 
for how many trails or modes each individual who wants to play for each visit, but at least play each mode 
once in a single session. The only difference between baseline and exit session was the song which used in them, 
in baseline session, "Twinkle Twinkle Little Star" was used as a standard entry-level song for all 
each individual chose participants and a customized song for exit session to 
motivate participants for better learning music, which makes it more difficult from the baseline session. 
By using the Module-Based Acoustic Music Interactive System, inputting multiple songs become possible and
less time-consuming. More than 10 songs are collected in the song bank, such as "Can Can" by Offenbach, 
"Shake if off" by Taylor Swift, "Spongebob Square Pants" from Spongebob cartoon, and "You are my Sunshine."
by Johnny Cash etc. Music styles are not only kid's songs like "Twinkle Twinkle" but also covered in classic, 
pop, ACG, folk, and more can be played by using such a platform. Because of the variate music style, NAO
can play, learning motivation can be successfully delivered among all sessions.\\

Each intervention session has divided into three parts: S1) warm-up; S2) single activity practice (with a color hint); 
and S3) music gameplay. Starting from intervention sessions, a user-customized song was used in the following 
sessions and have them engage more in multiple repetitive activities. 
The purpose of having a warm-up section is to have the motor control skill been practiced 
and meanwhile to help participants implement the motor skills in following activities with a fresh memory. The single activity was 
based on music practice from the baseline/exit session, other then those sessions, the single activity will
only have one type of music practice each session, for instance, the single-note play was 
delivered in the first intervention session. The next time this practice will become multiple notes 
play, and the level of difficulty for music play was gradually increased session after session. This was in
order to make a challenge based engagement activity for ASD groups for better motivation and emotion stimuli. 
As for music, the gameplay remained the same as the baseline/exit session. See details in Table \ref{session_detail}\\

% Please add the following required packages to your document preamble:
% \usepackage{multirow}
\begin{sidewaystable}[tbp]
\caption{Session Details: Baseline session, Intervention sessions, and Exit session. Different activities also included in this table.}
\vspace{3mm}
\label{session_detail}
\begin{tabular}{|c|c|c|l|l|}
\hline
\#                  & Session Type                                                                      & Outlines                                                                                                                                                  & \multicolumn{1}{c|}{Session Details}                                                                                                               & \multicolumn{1}{c|}{Purpose}                                                                                                                                                                                                                         \\ \hline
\multirow{9}{*}{1} & \multirow{9}{*}{\begin{tabular}[c]{@{}c@{}}Baseline   \\ Session\end{tabular}}    & \multirow{9}{*}{\begin{tabular}[c]{@{}c@{}}Include all music \\ activities in one session, \\ play song "Twinkle \\ Twinkle Little Star".\end{tabular}} & Music Practice:                                                                                                                                    & \multirow{9}{*}{\begin{tabular}[c]{@{}l@{}}Introduce the novel \\ platform to participants \\ for the first time. \\ Record music play \\ and social behavior \\ baseline. \\ Introduce music \\ game to user for \\ the first time.\end{tabular}} \\
                   &                                                                                   &                                                                                                                                                           & \hspace{5mm}Single   note strike                                                                                                                               &                                                                                                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                                           & \hspace{5mm}Multiple   notes strike                                                                                                                            &                                                                                                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                                           & \hspace{5mm}Half   song practice                                                                                                                               &                                                                                                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                                           & \hspace{5mm}Whole   song practice                                                                                                                              &                                                                                                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                                           & Music   Game:                                                                                                                                      &                                                                                                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                                           & \begin{tabular}[c]{@{}l@{}}\hspace{5mm}Mode 1) robot play song(s) based \\ \hspace{5mm}on user's request\end{tabular}                                                    &                                                                                                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                                           & \begin{tabular}[c]{@{}l@{}}\hspace{5mm}Mode 2) robot randomly plays \\ \hspace{5mm}consonance and dissonance sequence of notes, \\ \hspace{5mm}ask user to feel and playback.\end{tabular} &                                                                                                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                                           & \begin{tabular}[c]{@{}l@{}}\hspace{5mm}Mode 3) user play random melody \\ \hspace{5mm}for 5 seconds, robot playback, user \\ \hspace{5mm}grade robot performance.\end{tabular}   &                                                                                                                                                                                                                                                      \\ \hline
\multirow{6}{*}{2} & \multirow{12}{*}{\begin{tabular}[c]{@{}c@{}}Intervention \\ Session\end{tabular}} & \multirow{6}{*}{\begin{tabular}[c]{@{}c@{}}Single music activity \\ practice, all notes\\  coming from \\ customized song.\end{tabular}}                  & Warm-Up:                                                                                                                                           & \multirow{6}{*}{\begin{tabular}[c]{@{}l@{}}Mostly focus on motor \\ control skill practice. \\ First time introduce \\ music pitch to user. \\ Using teaching scenario \\ to practice turn-taking \\ behavior.\end{tabular}}                         \\
                   &                                                                                   &                                                                                                                                                           & \hspace{5mm}Single   bar strike regardless color                                                                                                               &                                                                                                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                                           & Single   Note Strike:                                                                                                                              &                                                                                                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                                           & \begin{tabular}[c]{@{}l@{}}\hspace{5mm}Single bar strike correspond to correct \\ \hspace{5mm}color.\end{tabular}                                                         &                                                                                                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                                           & Music   Game:                                                                                                                                      &                                                                                                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                                           & \hspace{5mm}Same as   previous session                                                                                                                         &                                                                                                                                                                                                                                                      \\ \cline{1-1} \cline{3-5} 
\multirow{6}{*}{3} &                                                                                   & \multirow{6}{*}{\begin{tabular}[c]{@{}c@{}}Multiple notes music \\ practice, all notes \\ coming from \\ customized song.\end{tabular}}                   & Warm-Up:                                                                                                                                           & \multirow{6}{*}{\begin{tabular}[c]{@{}l@{}}Review motor control \\ skill. \\ Simple music short \\ memory practice. \\ Using teaching scenario \\ to practice turn-taking \\ behavior.\end{tabular}}                                                 \\
                   &                                                                                   &                                                                                                                                                           & \hspace{5mm}Same as   previous session                                                                                                                         &                                                                                                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                                           & Multiple   Notes Strike:                                                                                                                           &                                                                                                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                                           & \begin{tabular}[c]{@{}l@{}}\hspace{5mm}2-3 multiple bars strike correspond \\ \hspace{5mm}to correct colors.\end{tabular}                                                &                                                                                                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                                           & Music   Game:                                                                                                                                      &                                                                                                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                                           & \hspace{5mm}Same as previous session                                                                                                                           &                                                                                                                                                                                                                                                      \\ \hline
\end{tabular}
\label{session_detail}
\end{sidewaystable}


\begin{sidewaystable}[tbp]
\caption{Continued Table for Session Details.}
\vspace{3mm}
\begin{tabular}{|c|c|c|l|l|}
\hline
\multicolumn{5}{|c|}{Continued table}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  \\ \hline
\multirow{6}{*}{4} & \multirow{12}{*}{\begin{tabular}[c]{@{}c@{}}Intervention \\ Session\end{tabular}} & \multirow{6}{*}{\begin{tabular}[c]{@{}c@{}}First   half customized \\ song practice.\end{tabular}}                                  & Warm-Up:                                                                                                                                                                                         & \multirow{6}{*}{\begin{tabular}[c]{@{}l@{}}Review previous music \\ and social behaviors \\ and skills. Implement all \\ skills to a harder challenge.\end{tabular}} \\
                   &                                                                                   &                                                                                                                                     & \hspace{5mm}Same as   previous session                                                                                                                                                                       &                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                     & Half   Song Practice:                                                                                                                                                                            &                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                     & \begin{tabular}[c]{@{}l@{}}\hspace{5mm}Randomly   select a chunk of \\ \hspace{5mm}melody from first half of the \\ \hspace{5mm}song (5-7 notes), ask user to   \\ \hspace{5mm}memorise the music and \\ \hspace{5mm}playback, with color hits.\end{tabular} &                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                     & Music   Game:                                                                                                                                                                                    &                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                     & \hspace{5mm}Same as   previous session                                                                                                                                                                       &                                                                                                                                                                      \\ \cline{1-1} \cline{3-5} 
\multirow{6}{*}{5} &                                                                                   & \multirow{6}{*}{\begin{tabular}[c]{@{}c@{}}Second   half customized \\ song practice.\end{tabular}}                                 & Warm-Up:                                                                                                                                                                                         & \multirow{6}{*}{\begin{tabular}[c]{@{}l@{}}Review previous music and\\ social behaviors and skills. \\ Implement all skills to harder \\ challenge.\end{tabular}}    \\
                   &                                                                                   &                                                                                                                                     & \hspace{5mm}Same as   previous session                                                                                                                                                                       &                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                     & Half   Song Practice:                                                                                                                                                                            &                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                     & \begin{tabular}[c]{@{}l@{}}\hspace{5mm}Randomly select a chunk of \\ \hspace{5mm}melody from second half of the \\ \hspace{5mm}song (5-7 notes), ask user to \\ \hspace{5mm}memorise the music and \\ \hspace{5mm}playback, with color hits.\end{tabular}    &                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                     & Music   Game:                                                                                                                                                                                    &                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                     & \hspace{5mm}Same as   previous session                                                                                                                                                                       &                                                                                                                                                                      \\ \hline
\multirow{9}{*}{6} & \multirow{9}{*}{\begin{tabular}[c]{@{}c@{}}Exit   \\ Session\end{tabular}}        & \multirow{9}{*}{\begin{tabular}[c]{@{}c@{}}Include   all music activities \\ in one session, play \\ customized song.\end{tabular}} & Music Practice:                                                                                                                                                                                  & \multirow{9}{*}{\begin{tabular}[c]{@{}l@{}}Compare music and social \\ performance with baseline \\ session.\end{tabular}}                                           \\
                   &                                                                                   &                                                                                                                                     & \hspace{5mm}Single   note strike                                                                                                                                                                             &                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                     & \hspace{5mm}Multiple   notes strike                                                                                                                                                                          &                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                     & \hspace{5mm}Half   song practice                                                                                                                                                                             &                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                     & \hspace{5mm}Whole   song practice                                                                                                                                                                            &                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                     & Music   Game:                                                                                                                                                                                    &                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                     & \hspace{5mm}Same as previous session                                                                                                                                                                         &                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                     & Music   Game:                                                                                                                                                                                    &                                                                                                                                                                      \\
                   &                                                                                   &                                                                                                                                     & \hspace{5mm}Same as previous session                                                                                                                                                                         &                                                                                                                                                                      \\ \hline
\end{tabular}
\end{sidewaystable}

\section{Module-Based Acoustic Music Interactive System Design}
In this section, a novel module-based robot-music teaching system is presented. 
Several goals need to be accomplished here: a) make the robot play sequence of notes or melody
fluently; b) have the robot play music notes accurately; c) be able to adopt multiple songs easily;
d) be able to have social communication between the robot and the participants; e) be able to 
deliver learning and teaching experiences to the participants; f) fast response and accurate
decision making. In order to meet these goals, a module-based acoustic music interactive system
was designed in this work. Three modules have been built in this intelligent system including Module 1: eye-hand 
self-calibration micro-adjustment system; Module 2: joint trajectory generator; and 
Module 3: real-time performance scoring feedback system. See Figure \ref{module}.\\

\begin{figure}[tbp]
	\begin{center}
		\begin{tabular}{c}
			\epsfig{figure=./chapters/fig/module_blocks.eps, scale = .5}\label{module} \\
		\end{tabular}
		\caption{Block Diagram of Module-Based Acoustic Music Interactive System} \label{module}
	\end{center}
\end{figure}

\subsection{Module 1: Eye-hand Self-Calibration Micro-Adjustment}
Knowing about the parameters of the robot's kinematic model is essential for 
high precision tasks, such as playing the xylophone. While the kinematic 
structure is known from the construction plan, errors can occur, e.g., due to the 
imperfect manufacturing. After multiple rounds of testing, it was found that the targeted angle chain 
of arms never actually equals the returned chain. We, therefore, used a 
calibration method to eliminate these errors accurately.\\
 

\subsubsection{Color-Based Object Tracking}
To play xylophone, the robot has to be able to adjust its motions according to
the estimated relative position of the instrument and the heads of the mallets it is 
holding. To estimate these poses, adopted in this thesis, we 
used a color-based technique.\\
The main idea is based on the RGB color of the center blue bar, given a hypothesis 
about the instrument's pose, one can project the contour of the object's model into the 
camera image and compare them to actually observed contour. In this way, it is possible 
to estimate the likelihood of the pose hypothesis. By using this method, it allows
the robot to track the instrument with very low cost in real-time. See Figure \ref{color_detection}\\
\begin{figure}[tbp]
	\begin{center}
		\begin{tabular}{c}
			\epsfig{figure=./chapters/fig/blue.eps, scale = 0.3}\label{single_color_a} \\
			(a)\\
			\epsfig{figure=./chapters/fig/all_color.eps, scale = 0.3
			} \label{all_color_b}\\
			(b)\\
			\epsfig{figure=./chapters/fig/color_detection.eps, scale = 0.6} \label{color_detection_c}\\
			(c)
			\end{tabular}
			\caption{Color Detection From NAO's Bottom Camera: (a) Single Blue Color Detection (b) Full Instrument Color Detection (c) Color Based Edge Detection.} \label{color_detection}
	\end{center}
\end{figure}

\subsection{Module 2: Joint Trajectory Generator}
Our system parses a list of hex-decimal numbers (from 1 to b) to obtain the sequence
of notes to play. It converts the notes into a joint trajectory using the beating
configurations obtained from inverse kinematics as control points. The timestamps
for the control points will be defined by the user to meet the experiment requirement.
The trajectory is then computed using Bezier interpolation in joint space by the
manufacturer-provided API and then sent to the robot controller for execution. In this
way, the robot plays in-time with the song.  \\
% is it ok to attach a youtube video link here to let people see how it works?

\subsection{Module 3: Real-Time Performance Scoring Feedback}
The purpose of this system is to provide a real-life interaction experience using 
music therapy to teach kids social skills and music knowledge.  In this scoring 
system, two core features were designed to complete the task: 1) music detection;
2) intelligent scoring-feedback system.\\


\subsubsection{A. Music Detection}
Music, in the understanding of science and technology, can be considered as a combination 
of time and frequency. To make the robot detect a sequence of frequencies, we adopted the 
short-time Fourier transform (STFT) to this audio feedback system. This allows the robot to 
be able to understand the music played by users and provide the proper feedback as
a music teaching instructor.\\

The short-time Fourier transform (STFT) is a Fourier-related transform used to 
determine the sinusoidal frequency and phase content of local sections of a signal 
as it changes over time. In practice, the procedure for computing STFTs is to divide 
a longer time signal into shorter segments of equal length and then compute the 
Fourier transform separately on each shorter segment. This reveals the Fourier 
spectrum on each shorter segment. One then usually plots the changing spectra as 
a function of time. In the discrete-time case, the data to be transformed could 
be broken up into chunks of frames (which usually overlap each other, to reduce 
artifacts at the boundary). Each chunk is Fourier transformed, and the complex 
result is added to a matrix, which records magnitude and phase for each point in 
time and frequency. This can be expressed as:
\\

${\displaystyle \mathbf {STFT} \{x[n]\}(m,\omega )\equiv X(m,\omega )=\sum _{n=-\infty }^{\infty }x[n]w[n-m]e^{-j\omega n}}$
\\

likewise, with signal x[n] and window w[n]. In this case, m is discrete and $\omega$ 
is continuous, but in most typical applications, the STFT is performed on a computer 
using the Fast Fourier Transform, so both variables are discrete and quantized.\\
The magnitude squared of the STFT yields the spectrogram representation of the Power 
Spectral Density of the function:
\\

${\displaystyle \operatorname {spectrogram} \{x(t)\}(\tau ,\omega )\equiv |X(\tau ,\omega )|^{2}}$\\

After the robot detects the notes from user input, a list of the hex-decimal number will be
returned. This list will be used in two purposes: 1) to compare with the target list
for scoring and sending feedback to the user; 2) used as a new input to have
robot playback in the game session.\\

\begin{figure}[tbp]
	\begin{center}
		\begin{tabular}{c}
			\epsfig{figure=./chapters/fig/stft.eps, scale = 1.5}\label{stft} \\
		\end{tabular}
		\caption{Melody Detection with Short Time Fourier Transform} \label{stft}
	\end{center}
\end{figure}

\subsubsection{B. Intelligent Scoring-Feedback System}
In order to compare the detected notes and the target notes, we used an algorithm
which is typically used in information theory linguistics called Levenshtein Distance.
This algorithm is a string metric for measuring the difference between two sequences.\\

In our case, the Levenshtein distance between two string-like hex-decimal numbers 
${\displaystyle a,b}$ (of length ${\displaystyle |a|}$ and ${\displaystyle |b|}$ respectively) 
is given by ${\displaystyle \operatorname {lev} _{a,b}(|a|,|b|)}$ where
\\

${\displaystyle \qquad \operatorname {lev} _{a,b}(i,j)={\begin{cases}\max(i,j)&{\text{ if }}\min(i,j)=0,\\\min {\begin{cases}\operatorname {lev} _{a,b}(i-1,j)+1\\\operatorname {lev} _{a,b}(i,j-1)+1\\\operatorname {lev} _{a,b}(i-1,j-1)+1_{(a_{i}\neq b_{j})}\end{cases}}&{\text{ otherwise.}}\end{cases}}}$\\
\\

where ${\displaystyle 1_{(a_{i}\neq b_{j})}}$ is the indicator function equal to 0 when 
${\displaystyle a_{i}=b_{j}}$ and equal to 1 otherwise, and ${\displaystyle \operatorname {lev} _{a,b}(i,j)}$ 
is the distance between the first ${\displaystyle i}$ characters of ${\displaystyle a}$ and the
first ${\displaystyle j}$ characters of ${\displaystyle b}$.

Note that the first element in the minimum corresponds to deletion (from ${\displaystyle a}$ to 
${\displaystyle b}$), the second to insertion and the third to match or mismatch, depending on 
whether the respective symbols are the same. Table \ref{LD} demonstrates how to apply this
principle in finding the Levenshtein distance of two words "Sunday" and "Saturday".\\

\begin{figure}[tbp]
	\begin{center}
		\begin{tabular}{c}
			\epsfig{figure=./chapters/fig/example_LD.eps, scale = .5}\label{LD} \\
		\end{tabular}
		\caption{An Example of Compute Levenshtein Distance for "Sunday" and "Saturday"} \label{LD}
	\end{center}
\end{figure}

Based on the real-life situation, we defined a likelihood margin for determining whether the result
is good or bad: \\
  
${likelihood = \dfrac{len(target) - lev_{target,source}}{len(target)}}$\\

where if the likelihood is more significant than 66\% (not including single note practice since it is only correct or incorrect in that case), the system will consider it as a good result.
This result will be passed to the accuracy calculation system to have the robot decide whether it
needs to add more dosage to the practice (e.g., 6 correct out of a total of 10 trials). More details will be discussed in the next chapters
as it relates to the experiment design.\\

\section{Summary}
In this chapter, we have discussed both hardware and software design for the experiment sessions
by using humanoid social assistive robot NAO in music teaching and playing.\\

From Chapter One, we determined to have NAO as a music teaching instructor be able
to both teach children pure music and deliver social content simultaneously.
To have the system ready, we first chose the proper agent, a robot named NAO, which is
kid-friendly and has complex social abilities. Second, based on the size of the robot, some necessary
accessories were purchased and handcrafted. A toy-sized color-coded xylophone became the
best option. Based on the size and position, a wooden based xylophone stand was 
customized and assembled in use. Due to the limitation of NAO hands size, a pair of mallet gripers 
were 3-D printed and customized. At last, an intelligent module-based acoustic music 
interactive system was designed fully from scratch in order to adopt the well-designed experiment 
sessions. With all preparation, three modules were able to have the robot 
play, listen, and teach the music freely. This allows NAO to become a great companion for 
children in both music learning and social communication. \\

The experiment session contains 3 types: baseline session, intervention sessions, and exit session.
A set of difficulty gradually increased music teaching activities were well designed among all sessions
in order to deliver better music content for participants. Both ASD and TD group kids were
experiencing a game like music challenge from playing the single note to the whole song. Music
game was designed to keep the session less tedious comparing to the learning part, and it also
provides an opportunity for us to learn more about the difference in learning and to teach 
music from the participants.\\

Module-based acoustic music interactive system design was challenging. Several problems need
to be solved. In order to improve the robot strike xylophone accuracy, Module 1 provides an autonomous 
self-awareness positioning system for the robot to localize the instrument and make the micro adjustment 
for arm joints that helps NAO plays the note bar correctly. Multiple songs were required to be able to 
play by NAO, program each song with specific arm movements sounds ridiculous. An easy music score
inputting method needs to be completed before the session starts. Module 2 allows the robot to be able 
to play any customized song of the user's request. This means that any songs which can be translated 
to either C-Major or a-minor key can have a well-trained person type in the hex-decimal playable 
score and allow the robot to be able to play it in seconds. Music teaching requests real-time feedback,
Module 3 was designed for providing real-life music teaching experience for system users. Two key features
of this module are designed: music detection and smart scoring feedback. Short-time Fourier transform
and Levenshtein distance are adapted to fulfill the requirement which allows the robot to understand
music and provide a proper dosage of practice and oral feedback to users.\\

